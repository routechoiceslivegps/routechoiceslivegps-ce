{% extends "base.html" %}
{% load compress hosts static %}
{% block extra_head %}
    {% compress css %}
        <link rel="stylesheet"
              href="{% static 'styles/dashboard/home.css' %}?_=2021100200" />
    {% endcompress %}
{% endblock extra_head %}

{% block content %}
    <div class="row">
        <div class="col-12 mx-auto">
            <div class="card border-0 shadow rounded-3 my-5">
                <div class="card-body p-4 p-sm-5">
                    <div class="col-12">
                        <div class="row">
                            <div class="col-12">
                                <h1>
                                    Hello {{ request.user.username }}! ðŸ™‚
                                </h1>
                                <div>
                                    <a href="{% host_url 'account_logout' host 'dashboard' %}"
                                    class="btn btn-info btn-sm mb-3">Logout <i class="fa-solid fa-arrow-right-from-bracket"></i></a>
                                </div>
                            </div>
                            <div class="col-12 col-lg-4 mb-lg-0 mb-3">
                                <h2><i class="fa-solid fa-circle-user"></i> Account</h2>
                                <ul class="list-group list-group-flush">
                                    <li  class="list-group-item">
                                        <a href="{% url 'account_edit_view' %}"><i class="fa-solid fa-user"></i> Your Details</a>
                                    </li>
                                    <li class="list-group-item">
                                        <a href="{% url 'account_email_list' %}"><i class="fa-solid fa-envelope"></i> Email Addresses</a>
                                    </li>
                                    <li class="list-group-item">
                                        <a href="{% url 'account_password_change_view' %}"><i class="fa-solid fa-key"></i> Password</a>
                                    </li>
                                    <li class="list-group-item">
                                        <a href="{% url 'kagi:two-factor-settings' %}"><i class="fa-solid fa-shield-halved"></i> Two-Factor Authentication</a>
                                    </li>
                                    <li class="list-group-item">
                                        <a href="{% url 'account_session:list_view' %}"><i class="fa-regular fa-window-restore"></i> Sessions</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-12 col-lg-4 mb-lg-0 mb-3 border-start-0 border-lg-start-1">
                                <h2><i class="fa-solid fa-house-flag"></i> Organisations</h2>
                                <ul class="list-group list-group-flush">
                                    {% for club in clubs %}
                                    <li class="list-group-item">
                                        <div class="card flex-row flex-no-wrap club-card border-0">
                                            <div class="border-0">
                                                <img class="card-img-left" src="{% if club.logo %}{{ club.logo_url }}{% else %}{% static "/img/club-default.png" %}{% endif %}" height="80" width="80" alt="Club {{ club.name }} Logo">
                                            </div>
                                            <div class="card-body px-2 py-1" style="word-break: break-word">
                                                <div class="d-flex flex-row bd-highlight justify-content-between">
                                                    <div class="p-2 bd-highlight">
                                                        <div>
                                                            <a class="link-primary-alt stretched-link text-decoration-none fw-bold"
                                                               style="font-size: 1.2rem"
                                                               href="{% url 'dashboard_club:edit_view' club_slug=club.slug %}?next={{ next }}">{{ club.name }}</a>
                                                        </div>
                                                        <div>
                                                            <small class="text-muted">
                                                                {% if club.upgraded %}
                                                                    Paid Plan{% if club.subscription_paused %} (Paused){% endif %}
                                                                {% elif club.o_club %}
                                                                    Orienteering club (Free usage ends January 1st 2026)
                                                                {% else %}
                                                                    Free Trial{% if not club.free_trial_active %} Expired{% endif %}
                                                                {% endif %}
                                                            </small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    {% empty %}
                                    <li class="list-group-item">No organisations yet.</li>
                                    {% endfor %}
                                </ul>
                                <div class="mt-2"><a href="{% url 'dashboard_club:select_view' %}">Manage your organisations</a></div>
                            </div>
                            <div class="col-12 col-lg-4 mb-lg-0 mb-3 border-start-0 border-lg-start-1">
                                <h2><i class="fa-solid fa-trophy"></i> Participations</h2>
                                <small><b>Latest participations</b></small>
                                <ul class="list-group list-group-flush">
                                {% for p in participations %}
                                    <li class="list-group-item">
                                        <a href="{{ p.event.get_absolute_url }}">{{ p.event.name }}</a> by {{ p.event.club.name }} as {{ p.name }} ({{ p.short_name }})
                                    </li>
                                {% empty %}
                                    <li class="list-group-item">No participations in any events.</li>
                                {% endfor %}
                                {% if has_more_participations %}<li class="list-group-item">And more...</li>{% endif %}
                                </ul>

                                {% if participations %}
                                <div class="mt-3"><a href="{% url 'dashboard_participations_view' %}">Manage your participations</a></div>
                                {% endif %}
                            </div>
                        </div>
                        <!--/.col-12.col-sm-9-->
                    </div>
                </div>
                <!--/row-->
            </div>
        </div>
    </div>
{% endblock content %}
